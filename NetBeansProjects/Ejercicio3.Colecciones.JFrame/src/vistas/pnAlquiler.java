/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package vistas;

import java.util.ArrayList;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JOptionPane;
import modelo.Cliente;
import modelo.Empresa;
import modelo.Sala;

/**
 *
 * @author Mario-Portatil
 */
public class pnAlquiler extends javax.swing.JPanel {

    Empresa miEmpresa;
    DefaultComboBoxModel modelo;

    /**
     * Creates new form pnAlquiler
     */
    public pnAlquiler(Empresa miEmpresa) {
        /*ponemos la empresa entre los parentesis del conductor
        porque nos hace falta la informacion que está
        en Empresa*/
        initComponents();
        this.miEmpresa = miEmpresa;
        modelo = new DefaultComboBoxModel();
        cmbSalas.setModel(modelo);
        cargarSalas();
    }

    public void cargarSalas() {
        /*Este método nos añade solo las salas que no estén alguilas.
         Las alquiladas no me las muestra*/
        ArrayList<Sala> misSalas = miEmpresa.getSalas();
        for (int i = 0; i < misSalas.size(); i++) {
            if (!misSalas.get(i).isAlquilado()) {//Si no está alquilada...
                modelo.addElement(misSalas.get(i));
            }
        }
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        cmbSalas = new javax.swing.JComboBox<>();
        jLabel2 = new javax.swing.JLabel();
        txtCif = new javax.swing.JTextField();
        btnCancelar = new javax.swing.JButton();
        btnAlquilar = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        txtNombre = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();

        cmbSalas.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                cmbSalasKeyPressed(evt);
            }
        });

        jLabel2.setText("CIF");

        txtCif.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                txtCifFocusLost(evt);
            }
        });
        txtCif.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtCifKeyPressed(evt);
            }
        });

        btnCancelar.setText("CANCELAR");

        btnAlquilar.setText("ALQUILAR");
        btnAlquilar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAlquilarActionPerformed(evt);
            }
        });

        jLabel1.setText("SALAS");

        jLabel5.setFont(new java.awt.Font("Perpetua Titling MT", 1, 13)); // NOI18N
        jLabel5.setText("ALQUILER DE SALAS");

        txtNombre.setEditable(false);

        jLabel3.setText("NOMBRE");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap(54, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addComponent(btnAlquilar)
                        .addGap(63, 63, 63)
                        .addComponent(btnCancelar)
                        .addGap(66, 66, 66))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel2)
                            .addComponent(jLabel1)
                            .addComponent(jLabel3))
                        .addGap(37, 37, 37)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(cmbSalas, javax.swing.GroupLayout.PREFERRED_SIZE, 172, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txtCif, javax.swing.GroupLayout.PREFERRED_SIZE, 209, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel5)
                            .addComponent(txtNombre, javax.swing.GroupLayout.PREFERRED_SIZE, 209, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(51, 51, 51))))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel5)
                .addGap(34, 34, 34)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(cmbSalas, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel1))
                .addGap(36, 36, 36)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(txtCif, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 35, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtNombre, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel3))
                .addGap(30, 30, 30)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnCancelar)
                    .addComponent(btnAlquilar))
                .addGap(46, 46, 46))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void txtCifKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtCifKeyPressed
        // aqui comproamos que el cif exista cuando damos enter
        String cif;
        Cliente c;
        if (evt.getKeyCode() == 10) { //el 10 es la tecla enter
            cif = txtCif.getText().trim();
            if (cif.equals("")) {
                JOptionPane.showMessageDialog(this, "Campo requerido");
            } else {
                c = miEmpresa.buscarCliente2(cif);
                if (c == null) {
                    JOptionPane.showMessageDialog(this, "Cliente inexistente");
                    txtCif.setText("");
                    txtNombre.setText("***********");
                } else {
                    txtNombre.setText(c.getNombre());
                }
            }
        }
    }//GEN-LAST:event_txtCifKeyPressed

    private void cmbSalasKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_cmbSalasKeyPressed
        if (evt.getKeyCode() == 112) {//112 corresponde a la tecla F1
            int posicion = cmbSalas.getSelectedIndex();
            Sala s = (Sala) modelo.getElementAt(posicion);
            JOptionPane.showMessageDialog(this, s.getNombre() + "\n Capacidad " + s.getCapacidad());
            /*"\n" es un salto de línea*/
        }
    }//GEN-LAST:event_cmbSalasKeyPressed

    private void btnAlquilarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAlquilarActionPerformed
        String cif = txtCif.getText().trim();
        if (!miEmpresa.buscarCliente(cif)) {
            JOptionPane.showMessageDialog(this, "Cliente inexistente");
            txtCif.setText("");
            txtNombre.setText("");
            txtCif.requestFocus();
        } else {
            if (cmbSalas.getSelectedIndex() != -1) {
                Sala s = (Sala) cmbSalas.getSelectedItem();
                s.setAlquilado(true);
                Cliente c = miEmpresa.buscarCliente2(cif);
                c.anadirNuevoAlquiler(s);
                JOptionPane.showMessageDialog(this, "Sala alquilada");
                actualizar();
            } else {
                JOptionPane.showMessageDialog(this, "TODAS LAS SALAS ESTÁN ALQUILADAS");
               //btnAlquilar.setEnabled(false);
            }
        }
    }//GEN-LAST:event_btnAlquilarActionPerformed

    private void txtCifFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txtCifFocusLost
        String cif = txtCif.getText().trim();
        Cliente c=miEmpresa.buscarCliente2(cif);
        txtNombre.setText(c.getNombre());
    }//GEN-LAST:event_txtCifFocusLost

    private void actualizar() {
        txtCif.setText("");
        txtNombre.setText("");
        int p = cmbSalas.getSelectedIndex();
        modelo.removeElementAt(p);
        if(modelo.getSize()==0){
         //esto también mira a ver si no hay salas, como lo hemos puesto en el método anterior
         //JOptionPane.showMessageDialog(this, "TODAS LAS SALAS ESTÁN ALQUILADAS");
         btnAlquilar.setEnabled(false);
         }
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAlquilar;
    private javax.swing.JButton btnCancelar;
    private javax.swing.JComboBox<String> cmbSalas;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JTextField txtCif;
    private javax.swing.JTextField txtNombre;
    // End of variables declaration//GEN-END:variables
}
